<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Code Master</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #00ff41; --bg: #0d1117; --panel: #161b22; --accent: #238636; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg); color: #c9d1d9; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; position: relative; }
        
        h1 { text-align: center; font-family: 'Orbitron', sans-serif; color: var(--primary); text-shadow: 0 0 10px rgba(0, 255, 65, 0.5); margin-bottom: 5px; }
        .subtitle { text-align: center; color: #8b949e; font-size: 0.9em; margin-bottom: 20px; }
        
        .panel { background: var(--panel); padding: 20px; border-radius: 12px; border: 1px solid #30363d; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); position: relative; }
        
        /* Form & Inputs */
        .form-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #8b949e; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 6px; box-sizing: border-box; font-family: 'Orbitron', sans-serif; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }

        /* Game Area */
        .binary-box { text-align: center; font-family: 'Orbitron', sans-serif; font-size: 3.5em; color: var(--primary); margin: 20px 0; letter-spacing: 5px; text-shadow: 0 0 15px var(--primary); }
        .game-controls { display: flex; gap: 10px; justify-content: center; }
        .answer-input { width: 120px; text-align: center; font-size: 1.5em; border: 2px solid var(--accent); }
        
        .btn { padding: 12px 25px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; font-family: 'Orbitron', sans-serif; }
        .btn-check { background: var(--accent); color: white; }
        .btn-check:hover { background: #2ea043; box-shadow: 0 0 10px var(--accent); }
        .btn-submit { width: 100%; background: #1f6feb; color: white; margin-top: 20px; display: none; }
        .btn-submit:hover { background: #388bfd; }

        .score-display { text-align: center; font-size: 1.2em; margin-top: 10px; }
        .score-val { color: #f1e05a; font-weight: bold; font-size: 1.4em; }

        /* Leaderboard */
        .leaderboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #30363d; padding-bottom: 10px; }
        .rank-table { width: 100%; border-collapse: collapse; }
        .rank-table th { text-align: left; color: #8b949e; font-size: 12px; padding: 10px; border-bottom: 1px solid #30363d; }
        .rank-table td { padding: 12px 10px; border-bottom: 1px solid #21262d; font-size: 14px; }
        .rank-1 { color: #ffd700; text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); } 
        .rank-2 { color: #c0c0c0; } 
        .rank-3 { color: #cd7f32; } 
        .loading-lb { text-align: center; color: var(--primary); font-style: italic; padding: 20px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* Tombol Musik & Help */
        .top-controls { position: absolute; top: 0; right: 0; display: flex; gap: 10px; }
        
        .icon-btn { 
            background: #21262d; border: 1px solid #30363d; color: white; border-radius: 50%; width: 40px; height: 40px; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: 0.3s;
        }
        .icon-btn:hover { background: #30363d; transform: scale(1.1); }
        
        .music-on { background: #238636; border-color: #2ea043; box-shadow: 0 0 10px var(--primary); }
        .btn-help { background: #1f6feb; border-color: #388bfd; }
        
        /* Tutorial Table in SweetAlert */
        .tutorial-table { width: 100%; border-collapse: collapse; margin-top: 10px; color: #333; }
        .tutorial-table td { border: 1px solid #ddd; padding: 5px; text-align: center; font-size: 12px; }
        .bin-val { font-weight: bold; color: #d35400; }
        .header-val { background: #eee; font-weight:bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-controls" style="position: relative; justify-content: flex-end; margin-bottom: 10px;">
        <button class="icon-btn btn-help" onclick="showHelp()" title="Cara Main">‚ùì</button>
        <button class="icon-btn" id="btnMusic" onclick="toggleMusic()" title="Musik On/Off">üîá</button>
    </div>

    <h1>BINARY MASTER</h1>
    <div class="subtitle">Random 6-8 Bit Challenge</div>

    <div class="panel">
        <form name="submit-score" id="gameForm">
            <div class="form-grid">
                <div class="form-group">
                    <label>KELAS</label>
                    <select name="Kelas" id="inputKelas" required>
                        <option value="" disabled selected>Pilih...</option>
                        <option value="Kelas 7">Kelas 7</option>
                        <option value="Kelas 8">Kelas 8</option>
                        <option value="Kelas 9">Kelas 9</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>NAMA TIM</label>
                    <input type="text" name="Nama Tim" id="inputTim" placeholder="Contoh: Tim Alpha" required>
                </div>
            </div>
            <label>ANGGOTA TIM</label>
            <input type="text" name="Nama Anggota" id="inputAnggota" placeholder="Anggota 1, Anggota 2..." required>
            <input type="hidden" name="Skor" id="inputSkor" value="0">
        </form>

        <hr style="border-color: #30363d; opacity: 0.3;">
        <div class="score-display">SKOR TIM: <span id="currentScore" class="score-val">0</span></div>
        <div class="binary-box" id="binaryQuestion">000000</div>
        
        <div class="game-controls">
            <input type="number" id="userAnswer" class="answer-input" placeholder="???" onkeypress="handleEnter(event)">
            <button onclick="checkAnswer()" class="btn btn-check">JAWAB</button>
        </div>
        <button type="button" class="btn btn-submit" id="btnKirim" onclick="kirimSkor()">UPLOAD SKOR TERBARU</button>
    </div>

    <div class="panel">
        <div class="leaderboard-header">
            <h3 style="margin:0; font-family:'Orbitron'; color:white;">üèÜ TOP 10 (HIGHEST)</h3>
            <button onclick="loadLeaderboard()" style="background:transparent; border:1px solid var(--primary); color:var(--primary); cursor:pointer; padding:5px 10px; border-radius:4px;">üîÑ Refresh</button>
        </div>
        <div id="leaderboard-content"><div class="loading-lb">Menghubungkan ke Server...</div></div>
    </div>
</div>

<script>
    // --- LINK APPS SCRIPT ANDA (Gunakan Link yang Terbaru) ---
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyffWgDHpxCjyUfqgN_H7L5C14z8RLYU9XA3hy6PJZK1rU0Y3lU9RXExbqNPR7gL7Sx/exec'; 

    // --- AUDIO SETUP ---
    const audioCorrect = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
    const audioWrong = new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg');
    const audioBG = new Audio('https://ia800905.us.archive.org/19/items/FREE_background_music_dhalius/backsound.mp3'); 
    
    audioBG.loop = true; 
    audioBG.volume = 0.5;

    let isMusicPlaying = false;
    let score = 0;
    let correctAnswer = 0;

    // --- FUNGSI POPUP PETUNJUK (TUTORIAL UPDATE 8 BIT) ---
    function showHelp() {
        Swal.fire({
            title: 'üéì Cara Bermain',
            html: `
                <div style="text-align:left; font-size:14px;">
                    <p>Ubah <b>Kode Biner (0 & 1)</b> menjadi angka <b>Desimal</b>.</p>
                    <p><b>Rumus Cepat (8 Bit):</b></p>
                    <table class="tutorial-table">
                        <tr class="header-val">
                            <td>128</td><td>64</td><td>32</td><td>16</td><td>8</td><td>4</td><td>2</td><td>1</td>
                        </tr>
                        <tr>
                            <td class="bin-val">0</td><td class="bin-val">1</td><td class="bin-val">0</td><td class="bin-val">0</td><td class="bin-val">1</td><td class="bin-val">0</td><td class="bin-val">1</td><td class="bin-val">1</td>
                        </tr>
                    </table>
                    <p style="margin-top:5px; font-size:13px;"><i>Contoh: 64 + 8 + 2 + 1 = <b>75</b></i></p>
                    <ul style="margin-top:10px;">
                        <li>‚úÖ Benar: <b>+10 Poin</b></li>
                        <li>‚ùå Salah: <b>-5 Poin</b></li>
                    </ul>
                </div>
            `,
            icon: 'info',
            confirmButtonText: 'Siap, Gass!',
            confirmButtonColor: '#238636'
        });
    }

    // --- LOGIKA MUSIK ---
    function toggleMusic() {
        const btn = document.getElementById('btnMusic');
        if (isMusicPlaying) {
            audioBG.pause();
            btn.innerHTML = "üîá";
            btn.classList.remove('music-on');
        } else {
            audioBG.play().catch(e => alert("Klik interaksi dulu!"));
            btn.innerHTML = "üéµ";
            btn.classList.add('music-on');
        }
        isMusicPlaying = !isMusicPlaying;
    }

    // --- LOGIKA GAME BARU (RANDOM 6-8 BIT) ---
    const iKelas = document.getElementById('inputKelas');
    const iTim = document.getElementById('inputTim');
    const iAnggota = document.getElementById('inputAnggota');

    window.onload = function() {
        if(localStorage.getItem('b_kelas')) iKelas.value = localStorage.getItem('b_kelas');
        if(localStorage.getItem('b_tim')) iTim.value = localStorage.getItem('b_tim');
        if(localStorage.getItem('b_anggota')) iAnggota.value = localStorage.getItem('b_anggota');
        generateQuestion();
        loadLeaderboard();
        
        audioCorrect.load(); audioWrong.load();
        
        setTimeout(() => {
            if(!sessionStorage.getItem('introShown')) {
                showHelp();
                sessionStorage.setItem('introShown', 'true');
            }
        }, 500);
    };

    [iKelas, iTim, iAnggota].forEach(el => {
        el.addEventListener('input', () => {
            localStorage.setItem('b_kelas', iKelas.value);
            localStorage.setItem('b_tim', iTim.value);
            localStorage.setItem('b_anggota', iAnggota.value);
        });
    });

    function generateQuestion() {
        // 1. Acak Panjang Bit: Antara 6, 7, atau 8
        // Math.random() * 3 hasilkan 0-2.99 -> Floor jadi 0, 1, 2 -> Tambah 6 jadi 6, 7, 8
        const bitLength = Math.floor(Math.random() * 3) + 6; 
        
        // 2. Tentukan Angka Maksimal (2 pangkat bitLength - 1)
        // 6 bit = 63, 7 bit = 127, 8 bit = 255
        const maxVal = Math.pow(2, bitLength) - 1;
        
        // 3. Acak Soal
        const decimalNum = Math.floor(Math.random() * maxVal) + 1;
        correctAnswer = decimalNum;
        
        // 4. Konversi ke Biner
        let bin = decimalNum.toString(2);
        
        // 5. Padding (Tambah 0 di depan sesuai panjang bit yang terpilih)
        while (bin.length < bitLength) {
            bin = "0" + bin;
        }
        
        document.getElementById('binaryQuestion').innerText = bin;
        document.getElementById('userAnswer').value = '';
        document.getElementById('userAnswer').focus();
    }

    function handleEnter(e) { if(e.key === 'Enter') checkAnswer(); }

    function checkAnswer() {
        const ans = parseInt(document.getElementById('userAnswer').value);
        if (isNaN(ans)) return;

        if (ans === correctAnswer) {
            score += 10;
            audioCorrect.currentTime = 0; audioCorrect.play().catch(e=>console.log(e));
            Swal.fire({ icon: 'success', title: '+10 Poin!', showConfirmButton: false, timer: 700, backdrop: `rgba(0,0,0,0.4)` });
            generateQuestion();
        } else {
            score -= 5;
            if(score < 0) score = 0;
            audioWrong.currentTime = 0; audioWrong.play().catch(e=>console.log(e));
            Swal.fire({ icon: 'error', title: 'Salah!', text: `Jawaban: ${correctAnswer}`, showConfirmButton: false, timer: 1000 });
            generateQuestion();
        }
        
        document.getElementById('currentScore').innerText = score;
        document.getElementById('inputSkor').value = score;
        if (score > 0) document.getElementById('btnKirim').style.display = 'block';
    }

    function kirimSkor() {
        if(!iKelas.value || !iTim.value) {
            Swal.fire('Ups', 'Isi dulu Kelas dan Nama Tim.', 'warning'); return;
        }

        const btn = document.getElementById('btnKirim');
        const form = document.getElementById('gameForm');

        Swal.fire({
            title: 'Upload Skor?',
            text: `Skor ${score} akan disimpan.`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#238636',
            confirmButtonText: 'Ya, Upload!'
        }).then((result) => {
            if (result.isConfirmed) {
                btn.innerHTML = "Mengirim..."; btn.disabled = true;
                
                fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                .then(response => {
                    btn.innerHTML = "UPLOAD SKOR TERBARU"; btn.disabled = false;
                    Swal.fire('Sukses!', 'Leaderboard diperbarui.', 'success');
                    loadLeaderboard();
                })
                .catch(error => {
                    btn.disabled = false;
                    Swal.fire('Error', 'Gagal koneksi.', 'error');
                });
            }
        });
    }

    function loadLeaderboard() {
        const container = document.getElementById('leaderboard-content');
        container.innerHTML = '<div class="loading-lb">Mengambil data dari Server...</div>';

        fetch(scriptURL)
            .then(response => response.json())
            .then(data => {
                let html = `
                    <table class="rank-table">
                        <thead>
                            <tr>
                                <th width="10%">#</th>
                                <th width="40%">TIM</th>
                                <th width="20%">KELAS</th>
                                <th width="30%" style="text-align:right">SKOR</th>
                            </tr>
                        </thead>
                        <tbody>`;

                if (data.length === 0) {
                    html += `<tr><td colspan="4" style="text-align:center; padding:20px;">Belum ada data.</td></tr>`;
                } else {
                    data.forEach((p, index) => {
                        let rankClass = ''; let icon = '';
                        if(index === 0) { rankClass = 'rank-1'; icon = 'üëë '; }
                        else if(index === 1) { rankClass = 'rank-2'; icon = 'ü•à '; }
                        else if(index === 2) { rankClass = 'rank-3'; icon = 'ü•â '; }

                        html += `<tr class="${rankClass}">
                                <td>${index + 1}</td>
                                <td>${icon}${p.tim}</td>
                                <td>${p.kelas}</td>
                                <td style="text-align:right">${p.skor}</td>
                            </tr>`;
                    });
                }
                html += `</tbody></table>`;
                container.innerHTML = html;
            })
            .catch(error => {
                console.error(error);
                container.innerHTML = '<div class="loading-lb" style="color:red">Gagal memuat data.</div>';
            });
    }
</script>

</body>
</html>
